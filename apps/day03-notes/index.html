<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NoteFlow</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-dark: #0b0f14;
      --panel-dark: rgba(255,255,255,0.03);
      --muted-dark: #93a3b7;
      --accent-dark: #60d394;
      --text-dark: #e6eef8;

      --bg-light: #f7f8fb;
      --panel-light: rgba(255,255,255,0.98);
      --muted-light: #475569;
      --accent-light: #2d7bff;
      --text-light: #0b1220;
    }

    /* default (dark theme) variables */
    :root {
      --bg: var(--bg-dark);
      --panel: var(--panel-dark);
      --muted: var(--muted-dark);
      --accent: var(--accent-dark);
      --text: var(--text-dark);
      --glass-border: rgba(255,255,255,0.04);
      --card-shadow: 0 8px 30px rgba(2,6,23,0.6);
    }

    /* light theme overrides applied to <html>.light */
    html.light {
      --bg: var(--bg-light);
      --panel: var(--panel-light);
      --muted: var(--muted-light);
      --accent: var(--accent-light);
      --text: var(--text-light);
      --glass-border: rgba(0,0,0,0.06);
      --card-shadow: 0 8px 30px rgba(2,6,23,0.06);
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(79,140,255,0.06), transparent),
        radial-gradient(900px 400px at 90% 80%, rgba(96,211,148,0.04), transparent),
        var(--bg);
      color: var(--text);
      transition: background .35s ease, color .25s ease;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--card-shadow);
      color: var(--text);
    }

    /* editor specifics */
    .smallmuted { color: var(--muted); font-size: 13px; }
    input::placeholder { color: rgba(255,255,255,0.35); }
    html.light input::placeholder { color: rgba(0,0,0,0.35); }

    .block[contenteditable="true"]:focus { outline: none; box-shadow: 0 8px 28px rgba(45,123,255,0.08); border-radius: .375rem; }
    .todo-checkbox { width: 18px; height: 18px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.06); display:inline-block; margin-right:8px; vertical-align:middle; }
    .drag-handle { cursor: grab; color: var(--muted); user-select: none; }

    /* block transitions */
    .fade-in { animation: fadeIn .22s ease both; }
    .fade-out { animation: fadeOut .18s ease both; }
    @keyframes fadeIn { from { opacity:0; transform: translateY(6px) scale(.995) } to { opacity:1; transform:none } }
    @keyframes fadeOut { from { opacity:1 } to { opacity:0; transform: translateY(6px) scale(.995) } }

    /* mobile drawer */
    #mobileDrawer { transition: transform .28s cubic-bezier(.2,.9,.2,1); transform: translateX(-110%); }
    #mobileDrawer.open { transform: translateX(0%); }

    /* FAB */
    .fab { position: fixed; right: 18px; bottom: 22px; z-index: 60; border-radius: 999px; width: 56px; height: 56px; display:flex; align-items:center; justify-content:center; font-weight:700; box-shadow: 0 12px 30px rgba(2,6,23,0.45); }

    pre.codeblock { white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, 'JetBrains Mono', monospace; padding: 12px; background: rgba(0,0,0,0.06); border-radius: 8px; color: var(--text); }

    img.block-image { max-width: 100%; border-radius: 8px; display: block; margin: 6px 0; }

    /* formatting toolbar */
    .format-toolbar { position: absolute; z-index: 70; display:flex; gap:6px; background: var(--panel); border:1px solid var(--glass-border); padding:6px; border-radius:8px; box-shadow: 0 6px 22px rgba(2,6,23,0.35); }

    @media (min-width: 1024px){ #mobileToggle { display: none; } }
    @media (max-width: 1023px){ aside.desktop-sidebar { display: none; } }

    /* ensure text color in light theme */
    html.light .panel { color: var(--text); }
    html.light .smallmuted { color: var(--muted); }
    html.light input, html.light textarea, html.light .block { color: var(--text); }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="max-w-7xl mx-auto flex items-center justify-between py-4 px-4 lg:px-0">
    <div class="flex items-center gap-4">
      <button id="mobileToggle" class="p-2 rounded-md panel glass-soft" aria-label="Open notes">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
      </button>
      <h1 class="text-xl font-semibold tracking-tight">NoteFlow</h1>
      <div class="ml-4 smallmuted hidden md:inline">Block editor — images, code, formatting, undo/redo</div>
    </div>

    <div class="flex items-center gap-3">
      <button id="graphViewBtn" class="panel px-3 py-2 rounded smallmuted" title="Open Graph View">Graph View</button>
      <!-- Undo / Redo -->
      <button id="undoBtn" class="panel px-3 py-2 rounded smallmuted" title="Undo (per note)">Undo</button>
      <button id="redoBtn" class="panel px-3 py-2 rounded smallmuted" title="Redo (per note)">Redo</button>

      <!-- format toolbar indicator (desktop) -->
      <div id="formatToolbarWrapper" style="position:relative;"></div>

      <!-- Theme toggle -->
      <button id="themeToggle" class="panel p-2 rounded-md flex items-center gap-2 smallmuted" title="Toggle theme">
        <svg id="themeIcon" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 3v2M12 19v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4M12 7a5 5 0 100 10 5 5 0 000-10z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
    </div>
  </header>

  <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-4 gap-6 px-4 lg:px-0">
    <!-- Desktop Sidebar -->
    <aside class="col-span-1 panel p-4 h-[78vh] desktop-sidebar">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">Notes</h2>
        <div class="flex gap-2">
          <button id="exportAllBtn" class="px-2 py-1 rounded bg-yellow-400 text-black text-sm">Export</button>
        </div>
      </div>

      <div class="mb-3 flex gap-2">
        <button id="newNoteBtn" class="flex-1 bg-accent text-white px-3 py-2 rounded">+ New</button>
        <label class="bg-transparent panel px-3 py-2 rounded cursor-pointer smallmuted">
          Import
          <input id="importAllInput" type="file" accept=".json" class="hidden" />
        </label>
      </div>

      <div class="flex-1 overflow-auto" id="notesList"></div>

      <div class="mt-3 text-xs smallmuted">Saved locally. Export JSON to backup/restore.</div>
    </aside>

    <!-- Mobile drawer (slide-in) -->
    <div id="mobileDrawer" class="fixed top-0 left-0 h-full w-[86vw] max-w-xs panel p-4 glass-soft z-50 lg:hidden">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-semibold">Notes</h3>
        <button id="mobileClose" class="p-2 rounded-md smallmuted">✕</button>
      </div>

      <div class="mb-3 flex gap-2">
        <button id="newNoteBtnMobile" class="flex-1 bg-accent text-white px-3 py-2 rounded">+ New</button>
        <label class="bg-transparent panel px-3 py-2 rounded cursor-pointer smallmuted">
          Import
          <input id="importAllInputMobile" type="file" accept=".json" class="hidden" />
        </label>
      </div>

      <div class="flex-1 overflow-auto" id="notesListMobile"></div>
      <div class="mt-3 text-xs smallmuted">Tap a note to open. Tap outside to close.</div>
    </div>

    <!-- Editor -->
    <section class="col-span-1 lg:col-span-3 panel p-6 rounded-lg flex flex-col h-[78vh]">
      <div class="flex items-start justify-between gap-4">
        <div class="flex-1 min-w-0">
          <input id="noteTitle" class="w-full bg-transparent text-2xl font-semibold border-0 placeholder:opacity-60 focus:outline-none" placeholder="Untitled note" />
          <div id="noteMeta" class="smallmuted text-xs mt-1"></div>
        </div>
        <div class="flex items-center gap-2">
          <button id="exportNoteBtn" class="px-3 py-1 panel rounded smallmuted">Export</button>
          <button id="deleteNoteBtn" class="px-3 py-1 panel rounded smallmuted text-red-400">Delete</button>
        </div>
      </div>

      <div id="blocksArea" class="flex-1 overflow-auto p-3 rounded mt-4 bg-transparent relative"></div>

      <div class="mt-3 text-sm smallmuted">Tip: type <code>/h</code> for heading, <code>/todo</code> for checkbox, <code>/hr</code> for divider. Use the toolbar to format.</div>
    </section>
  </main>

  <!-- Floating new note button for mobile -->
  <button id="fabNew" class="fab bg-accent text-black hidden lg:hidden">+</button>

  <!-- Formatting toolbar template (will be positioned absolutely when needed) -->
  <div id="formatToolbar" style="display:none" class="format-toolbar">
    <button id="fmtBold" class="panel px-2 py-1 rounded smallmuted" title="Bold (Ctrl/Cmd+B)"><strong>B</strong></button>
    <button id="fmtItalic" class="panel px-2 py-1 rounded smallmuted" title="Italic (Ctrl/Cmd+I)"><em>I</em></button>
    <button id="insertImage" class="panel px-2 py-1 rounded smallmuted" title="Insert image by URL">Image</button>
    <button id="insertCode" class="panel px-2 py-1 rounded smallmuted" title="Insert code block">Code</button>
  </div>

  <!-- Footer small status (desktop) -->
  <div class="max-w-7xl mx-auto px-4 lg:px-0 mt-4 smallmuted" id="plStatus">Ready</div>

  <script src="app.js"></script>
</body>
</html>
